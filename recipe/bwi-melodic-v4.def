BootStrap: docker
From: tacc/tacc-ubuntu18-mvapich2.3-ib:latest

%labels

%help
    c303-005.ls6(1006)$ ibrun singularity run containers/bwi-melodic-v4.simg osu_bcast
    TACC:  Starting up job 1098372
    TACC:  Starting parallel tasks...

    # OSU MPI Broadcast Latency Test v5.6
    # Size       Avg Latency(us)
    Warning: Process to core binding is enabled and OMP_NUM_THREADS is set to non-zero (1) value
    If your program has OpenMP sections, this can cause over-subscription of cores and consequently poor performance
    To avoid this, please re-run your application after setting MV2_ENABLE_AFFINITY=0
    Use MV2_USE_THREAD_WARNING=0 to suppress this message
    1                      29.79
    2                       8.11
    4                       8.16
    8                       7.81
    16                      8.03
    32                      8.02
    64                      8.05
    128                     8.06
    256                     8.85
    512                     9.70
    1024                   11.28
    2048                   13.54
    4096                   19.99
    8192                   20.79
    16384                  30.74
    32768                  49.44
    65536                  91.12
    131072                186.23
    262144                642.43
    524288               1334.01
    1048576               791.26
    TACC:  Shutdown complete. Exiting.
%files

%post
    export ROS_DISTRO=melodic
    export DEBIAN_FRONTEND=noninteractive

    apt-get update && apt-get install -y gnupg apt-utils curl nano vim tmux python-pip
    echo 'deb http://packages.ros.org/ros/ubuntu bionic main' > /etc/apt/sources.list.d/ros-latest.list
    curl -s https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | apt-key add -

    apt-get update
    apt-get install -y ros-${ROS_DISTRO}-desktop-full python-rosdep python-rosinstall python-rosinstall-generator \
                       python-wstool build-essential python-catkin-tools libqt5websockets5-dev qt5-default
    pip install -U pyYAML
    rosdep init

%environment
    # ros
    export ROS_HOSTNAME=localhost
    export ROS_MASTER_URI=http://localhost:11311